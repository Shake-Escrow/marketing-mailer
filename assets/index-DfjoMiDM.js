import{r as Ne,a as Ie,u as De,b as Pe,d as ne,P as Me,M as Fe}from"./msal-FckaZgfA.js";import{r as Ue}from"./vendor-TrU4HtWd.js";import{r as ze}from"./mammoth-DLirEAGF.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))a(u);new MutationObserver(u=>{for(const _ of u)if(_.type==="childList")for(const h of _.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function b(u){const _={};return u.integrity&&(_.integrity=u.integrity),u.referrerPolicy&&(_.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?_.credentials="include":u.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function a(u){if(u.ep)return;u.ep=!0;const _=b(u);fetch(u.href,_)}})();var we={exports:{}},ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var je;function qe(){if(je)return ge;je=1;var p=Ne(),g=Symbol.for("react.element"),b=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,u=p.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_={key:!0,ref:!0,__self:!0,__source:!0};function h(A,R,n){var j,L={},v=null,F=null;n!==void 0&&(v=""+n),R.key!==void 0&&(v=""+R.key),R.ref!==void 0&&(F=R.ref);for(j in R)a.call(R,j)&&!_.hasOwnProperty(j)&&(L[j]=R[j]);if(A&&A.defaultProps)for(j in R=A.defaultProps,R)L[j]===void 0&&(L[j]=R[j]);return{$$typeof:g,type:A,key:v,ref:F,props:L,_owner:u.current}}return ge.Fragment=b,ge.jsx=h,ge.jsxs=h,ge}var Ee;function Be(){return Ee||(Ee=1,we.exports=qe()),we.exports}var s=Be(),xe={},Re;function $e(){if(Re)return xe;Re=1;var p=Ue();return xe.createRoot=p.createRoot,xe.hydrateRoot=p.hydrateRoot,xe}var He=$e();const We={auth:{clientId:"0b4519f6-3e5a-4bc7-927c-219b9104825b",authority:"https://login.microsoftonline.com/76ef6c29-fcf7-4941-9312-3a70fb1abd8b",redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},Oe={scopes:["Mail.Send","User.Read"]};var Ke=ze();const Je=Ie(Ke);async function Ve(p){const g=await p.arrayBuffer(),b=await Je.convertToHtml({arrayBuffer:g}),a=b.value,u=b.messages,_=document.createElement("div");_.innerHTML=a;let h="";const A=Array.from(_.children),R=v=>v.textContent.trim()==="";let n=A.findIndex(v=>!R(v));if(n!==-1){const v=A[n],F=v.textContent.trim(),te=F.match(/^subject\s*:\s*(.+)$/i);if(te)h=te[1].trim(),v.remove();else{const G=A.slice(n+1).findIndex(K=>!R(K)),X=G!==-1?A.slice(n+1)[G]:null;X&&/^dear\s/i.test(X.textContent.trim())?(h=F,v.remove()):v.tagName==="H1"?h=F:h=F.substring(0,80)}}Qe(_);const j=_.innerHTML,L=_.textContent.replace(/\s+/g," ").trim();return{html:j,text:L,subject:h,warnings:u.filter(v=>v.type==="warning").map(v=>v.message)}}function Qe(p){const g=document.createTreeWalker(p,NodeFilter.SHOW_TEXT),b=[];let a;for(;a=g.nextNode();)b.push(a);for(const u of b)u.nodeValue=u.nodeValue.replace(/\bDear\s+(?!{{name}})([^,:\n]+)[,:]?/gi,(_,h,A,R)=>{const n=_.trim(),j=n.endsWith(","),L=n.endsWith(":");return"Dear {{name}},"})}function be(p,g){return p.replace(/\{\{(\s*[\w.-]+\s*)\}\}/g,(b,a)=>{const u=a.trim().toLowerCase();return g[u]!==void 0?g[u]:b})}var ve={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Xe=ve.exports,Te;function Ye(){return Te||(Te=1,(function(p,g){((b,a)=>{p.exports=a()})(Xe,function b(){var a=typeof self<"u"?self:typeof window<"u"?window:a!==void 0?a:{},u,_=!a.document&&!!a.postMessage,h=a.IS_PAPA_WORKER||!1,A={},R=0,n={};function j(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var r=de(t);r.chunkSize=parseInt(r.chunkSize),t.step||t.chunk||(r.chunkSize=null),this._handle=new G(r),(this._handle.streamer=this)._config=r}).call(this,e),this.parseChunk=function(t,r){var o=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<o){let y=this._config.newline;y||(i=this._config.quoteChar||'"',y=this._handle.guessLineEndings(t,i)),t=[...t.split(y).slice(o)].join(y)}this.isFirstChunk&&E(this._config.beforeFirstChunk)&&(i=this._config.beforeFirstChunk(t))!==void 0&&(t=i),this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+t,i=(this._partialLine="",this._handle.parse(o,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=i.meta.cursor,o=(this._finished||(this._partialLine=o.substring(t-this._baseIndex),this._baseIndex=t),i&&i.data&&(this._rowCount+=i.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),h)a.postMessage({results:i,workerId:n.WORKER_ID,finished:o});else if(E(this._config.chunk)&&!r){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=i=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!o||!E(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(t){E(this._config.error)?this._config.error(t):h&&this._config.error&&a.postMessage({workerId:n.WORKER_ID,error:t,finished:!1})}}function L(e){var t;(e=e||{}).chunkSize||(e.chunkSize=n.RemoteChunkSize),j.call(this,e),this._nextChunk=_?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(r){this._input=r,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),_||(t.onload=se(this._chunkLoaded,this),t.onerror=se(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!_),this._config.downloadRequestHeaders){var r,o=this._config.downloadRequestHeaders;for(r in o)t.setRequestHeader(r,o[r])}var i;this._config.chunkSize&&(i=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+i));try{t.send(this._config.downloadRequestBody)}catch(y){this._chunkError(y.message)}_&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(r=>(r=r.getResponseHeader("Content-Range"))!==null?parseInt(r.substring(r.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(r){r=t.statusText||r,this._sendError(new Error(r))}}function v(e){(e=e||{}).chunkSize||(e.chunkSize=n.LocalChunkSize),j.call(this,e);var t,r,o=typeof FileReader<"u";this.stream=function(i){this._input=i,r=i.slice||i.webkitSlice||i.mozSlice,o?((t=new FileReader).onload=se(this._chunkLoaded,this),t.onerror=se(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var i=this._input,y=(this._config.chunkSize&&(y=Math.min(this._start+this._config.chunkSize,this._input.size),i=r.call(i,this._start,y)),t.readAsText(i,this._config.encoding));o||this._chunkLoaded({target:{result:y}})},this._chunkLoaded=function(i){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(i.target.result)},this._chunkError=function(){this._sendError(t.error)}}function F(e){var t;j.call(this,e=e||{}),this.stream=function(r){return t=r,this._nextChunk()},this._nextChunk=function(){var r,o;if(!this._finished)return r=this._config.chunkSize,t=r?(o=t.substring(0,r),t.substring(r)):(o=t,""),this._finished=!t,this.parseChunk(o)}}function te(e){j.call(this,e=e||{});var t=[],r=!0,o=!1;this.pause=function(){j.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){j.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(i){this._input=i,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){o&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):r=!0},this._streamData=se(function(i){try{t.push(typeof i=="string"?i:i.toString(this._config.encoding)),r&&(r=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(y){this._streamError(y)}},this),this._streamError=se(function(i){this._streamCleanUp(),this._sendError(i)},this),this._streamEnd=se(function(){this._streamCleanUp(),o=!0,this._streamData("")},this),this._streamCleanUp=se(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function G(e){var t,r,o,i,y=Math.pow(2,53),z=-y,O=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,T=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,d=this,w=0,f=0,H=!1,l=!1,k=[],c={data:[],errors:[],meta:{}};function N(C){return e.skipEmptyLines==="greedy"?C.join("").trim()==="":C.length===1&&C[0].length===0}function M(){if(c&&o&&(ee("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+n.DefaultDelimiter+"'"),o=!1),e.skipEmptyLines&&(c.data=c.data.filter(function(m){return!N(m)})),J()){let m=function(B,$){E(e.transformHeader)&&(B=e.transformHeader(B,$)),k.push(B)};if(c)if(Array.isArray(c.data[0])){for(var C=0;J()&&C<c.data.length;C++)c.data[C].forEach(m);c.data.splice(0,1)}else c.data.forEach(m)}function I(m,B){for(var $=e.header?{}:[],D=0;D<m.length;D++){var P=D,S=m[D],S=((re,x)=>(U=>(e.dynamicTypingFunction&&e.dynamicTyping[U]===void 0&&(e.dynamicTyping[U]=e.dynamicTypingFunction(U)),(e.dynamicTyping[U]||e.dynamicTyping)===!0))(re)?x==="true"||x==="TRUE"||x!=="false"&&x!=="FALSE"&&((U=>{if(O.test(U)&&(U=parseFloat(U),z<U&&U<y))return 1})(x)?parseFloat(x):T.test(x)?new Date(x):x===""?null:x):x)(P=e.header?D>=k.length?"__parsed_extra":k[D]:P,S=e.transform?e.transform(S,P):S);P==="__parsed_extra"?($[P]=$[P]||[],$[P].push(S)):$[P]=S}return e.header&&(D>k.length?ee("FieldMismatch","TooManyFields","Too many fields: expected "+k.length+" fields but parsed "+D,f+B):D<k.length&&ee("FieldMismatch","TooFewFields","Too few fields: expected "+k.length+" fields but parsed "+D,f+B)),$}var q;c&&(e.header||e.dynamicTyping||e.transform)&&(q=1,!c.data.length||Array.isArray(c.data[0])?(c.data=c.data.map(I),q=c.data.length):c.data=I(c.data,0),e.header&&c.meta&&(c.meta.fields=k),f+=q)}function J(){return e.header&&k.length===0}function ee(C,I,q,m){C={type:C,code:I,message:q},m!==void 0&&(C.row=m),c.errors.push(C)}E(e.step)&&(i=e.step,e.step=function(C){c=C,J()?M():(M(),c.data.length!==0&&(w+=C.data.length,e.preview&&w>e.preview?r.abort():(c.data=c.data[0],i(c,d))))}),this.parse=function(C,I,q){var m=e.quoteChar||'"',m=(e.newline||(e.newline=this.guessLineEndings(C,m)),o=!1,e.delimiter?E(e.delimiter)&&(e.delimiter=e.delimiter(C),c.meta.delimiter=e.delimiter):((m=((B,$,D,P,S)=>{var re,x,U,ue;S=S||[",","	","|",";",n.RECORD_SEP,n.UNIT_SEP];for(var he=0;he<S.length;he++){for(var ie,pe=S[he],V=0,ae=0,W=0,Y=(U=void 0,new K({comments:P,delimiter:pe,newline:$,preview:10}).parse(B)),le=0;le<Y.data.length;le++)D&&N(Y.data[le])?W++:(ie=Y.data[le].length,ae+=ie,U===void 0?U=ie:0<ie&&(V+=Math.abs(ie-U),U=ie));0<Y.data.length&&(ae/=Y.data.length-W),(x===void 0||V<=x)&&(ue===void 0||ue<ae)&&1.99<ae&&(x=V,re=pe,ue=ae)}return{successful:!!(e.delimiter=re),bestDelimiter:re}})(C,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=m.bestDelimiter:(o=!0,e.delimiter=n.DefaultDelimiter),c.meta.delimiter=e.delimiter),de(e));return e.preview&&e.header&&m.preview++,t=C,r=new K(m),c=r.parse(t,I,q),M(),H?{meta:{paused:!0}}:c||{meta:{paused:!1}}},this.paused=function(){return H},this.pause=function(){H=!0,r.abort(),t=E(e.chunk)?"":t.substring(r.getCharIndex())},this.resume=function(){d.streamer._halted?(H=!1,d.streamer.parseChunk(t,!0)):setTimeout(d.resume,3)},this.aborted=function(){return l},this.abort=function(){l=!0,r.abort(),c.meta.aborted=!0,E(e.complete)&&e.complete(c),t=""},this.guessLineEndings=function(B,m){B=B.substring(0,1048576);var m=new RegExp(X(m)+"([^]*?)"+X(m),"gm"),q=(B=B.replace(m,"")).split("\r"),m=B.split(`
`),B=1<m.length&&m[0].length<q[0].length;if(q.length===1||B)return`
`;for(var $=0,D=0;D<q.length;D++)q[D][0]===`
`&&$++;return $>=q.length/2?`\r
`:"\r"}}function X(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function K(e){var t=(e=e||{}).delimiter,r=e.newline,o=e.comments,i=e.step,y=e.preview,z=e.fastMode,O=null,T=!1,d=e.quoteChar==null?'"':e.quoteChar,w=d;if(e.escapeChar!==void 0&&(w=e.escapeChar),(typeof t!="string"||-1<n.BAD_DELIMITERS.indexOf(t))&&(t=","),o===t)throw new Error("Comment character same as delimiter");o===!0?o="#":(typeof o!="string"||-1<n.BAD_DELIMITERS.indexOf(o))&&(o=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var f=0,H=!1;this.parse=function(l,k,c){if(typeof l!="string")throw new Error("Input must be a string");var N=l.length,M=t.length,J=r.length,ee=o.length,C=E(i),I=[],q=[],m=[],B=f=0;if(!l)return V();if(z||z!==!1&&l.indexOf(d)===-1){for(var $=l.split(r),D=0;D<$.length;D++){if(m=$[D],f+=m.length,D!==$.length-1)f+=r.length;else if(c)return V();if(!o||m.substring(0,ee)!==o){if(C){if(I=[],ue(m.split(t)),ae(),H)return V()}else ue(m.split(t));if(y&&y<=D)return I=I.slice(0,y),V(!0)}}return V()}for(var P=l.indexOf(t,f),S=l.indexOf(r,f),re=new RegExp(X(w)+X(d),"g"),x=l.indexOf(d,f);;)if(l[f]===d)for(x=f,f++;;){if((x=l.indexOf(d,x+1))===-1)return c||q.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:I.length,index:f}),ie();if(x===N-1)return ie(l.substring(f,x).replace(re,d));if(d===w&&l[x+1]===w)x++;else if(d===w||x===0||l[x-1]!==w){P!==-1&&P<x+1&&(P=l.indexOf(t,x+1));var U=he((S=S!==-1&&S<x+1?l.indexOf(r,x+1):S)===-1?P:Math.min(P,S));if(l.substr(x+1+U,M)===t){m.push(l.substring(f,x).replace(re,d)),l[f=x+1+U+M]!==d&&(x=l.indexOf(d,f)),P=l.indexOf(t,f),S=l.indexOf(r,f);break}if(U=he(S),l.substring(x+1+U,x+1+U+J)===r){if(m.push(l.substring(f,x).replace(re,d)),pe(x+1+U+J),P=l.indexOf(t,f),x=l.indexOf(d,f),C&&(ae(),H))return V();if(y&&I.length>=y)return V(!0);break}q.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:I.length,index:f}),x++}}else if(o&&m.length===0&&l.substring(f,f+ee)===o){if(S===-1)return V();f=S+J,S=l.indexOf(r,f),P=l.indexOf(t,f)}else if(P!==-1&&(P<S||S===-1))m.push(l.substring(f,P)),f=P+M,P=l.indexOf(t,f);else{if(S===-1)break;if(m.push(l.substring(f,S)),pe(S+J),C&&(ae(),H))return V();if(y&&I.length>=y)return V(!0)}return ie();function ue(W){I.push(W),B=f}function he(W){var Y=0;return Y=W!==-1&&(W=l.substring(x+1,W))&&W.trim()===""?W.length:Y}function ie(W){return c||(W===void 0&&(W=l.substring(f)),m.push(W),f=N,ue(m),C&&ae()),V()}function pe(W){f=W,ue(m),m=[],S=l.indexOf(r,f)}function V(W){if(e.header&&!k&&I.length&&!T){var Y=I[0],le=Object.create(null),ke=new Set(Y);let Ce=!1;for(let fe=0;fe<Y.length;fe++){let oe=Y[fe];if(le[oe=E(e.transformHeader)?e.transformHeader(oe,fe):oe]){let me,Se=le[oe];for(;me=oe+"_"+Se,Se++,ke.has(me););ke.add(me),Y[fe]=me,le[oe]++,Ce=!0,(O=O===null?{}:O)[me]=oe}else le[oe]=1,Y[fe]=oe;ke.add(oe)}Ce&&console.warn("Duplicate headers found and renamed."),T=!0}return{data:I,errors:q,meta:{delimiter:t,linebreak:r,aborted:H,truncated:!!W,cursor:B+(k||0),renamedHeaders:O}}}function ae(){i(V()),I=[],q=[]}},this.abort=function(){H=!0},this.getCharIndex=function(){return f}}function Z(e){var t=e.data,r=A[t.workerId],o=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var i={abort:function(){o=!0,Q(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:ce,resume:ce};if(E(r.userStep)){for(var y=0;y<t.results.data.length&&(r.userStep({data:t.results.data[y],errors:t.results.errors,meta:t.results.meta},i),!o);y++);delete t.results}else E(r.userChunk)&&(r.userChunk(t.results,i,t.file),delete t.results)}t.finished&&!o&&Q(t.workerId,t.results)}function Q(e,t){var r=A[e];E(r.userComplete)&&r.userComplete(t),r.terminate(),delete A[e]}function ce(){throw new Error("Not implemented.")}function de(e){if(typeof e!="object"||e===null)return e;var t,r=Array.isArray(e)?[]:{};for(t in e)r[t]=de(e[t]);return r}function se(e,t){return function(){e.apply(t,arguments)}}function E(e){return typeof e=="function"}return n.parse=function(e,t){var r=(t=t||{}).dynamicTyping||!1;if(E(r)&&(t.dynamicTypingFunction=r,r={}),t.dynamicTyping=r,t.transform=!!E(t.transform)&&t.transform,!t.worker||!n.WORKERS_SUPPORTED)return r=null,n.NODE_STREAM_INPUT,typeof e=="string"?(e=(o=>o.charCodeAt(0)!==65279?o:o.slice(1))(e),r=new(t.download?L:F)(t)):e.readable===!0&&E(e.read)&&E(e.on)?r=new te(t):(a.File&&e instanceof File||e instanceof Object)&&(r=new v(t)),r.stream(e);(r=(()=>{var o;return!!n.WORKERS_SUPPORTED&&(o=(()=>{var i=a.URL||a.webkitURL||null,y=b.toString();return n.BLOB_URL||(n.BLOB_URL=i.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",y,")();"],{type:"text/javascript"})))})(),(o=new a.Worker(o)).onmessage=Z,o.id=R++,A[o.id]=o)})()).userStep=t.step,r.userChunk=t.chunk,r.userComplete=t.complete,r.userError=t.error,t.step=E(t.step),t.chunk=E(t.chunk),t.complete=E(t.complete),t.error=E(t.error),delete t.worker,r.postMessage({input:e,config:t,workerId:r.id})},n.unparse=function(e,t){var r=!1,o=!0,i=",",y=`\r
`,z='"',O=z+z,T=!1,d=null,w=!1,f=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||n.BAD_DELIMITERS.filter(function(k){return t.delimiter.indexOf(k)!==-1}).length||(i=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(r=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(T=t.skipEmptyLines),typeof t.newline=="string"&&(y=t.newline),typeof t.quoteChar=="string"&&(z=t.quoteChar),typeof t.header=="boolean"&&(o=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");d=t.columns}t.escapeChar!==void 0&&(O=t.escapeChar+z),t.escapeFormulae instanceof RegExp?w=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(w=/^[=+\-@\t\r].*$/)}})(),new RegExp(X(z),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return H(null,e,T);if(typeof e[0]=="object")return H(d||Object.keys(e[0]),e,T)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||d),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),H(e.fields||[],e.data||[],T);throw new Error("Unable to serialize unrecognized input");function H(k,c,N){var M="",J=(typeof k=="string"&&(k=JSON.parse(k)),typeof c=="string"&&(c=JSON.parse(c)),Array.isArray(k)&&0<k.length),ee=!Array.isArray(c[0]);if(J&&o){for(var C=0;C<k.length;C++)0<C&&(M+=i),M+=l(k[C],C);0<c.length&&(M+=y)}for(var I=0;I<c.length;I++){var q=(J?k:c[I]).length,m=!1,B=J?Object.keys(c[I]).length===0:c[I].length===0;if(N&&!J&&(m=N==="greedy"?c[I].join("").trim()==="":c[I].length===1&&c[I][0].length===0),N==="greedy"&&J){for(var $=[],D=0;D<q;D++){var P=ee?k[D]:D;$.push(c[I][P])}m=$.join("").trim()===""}if(!m){for(var S=0;S<q;S++){0<S&&!B&&(M+=i);var re=J&&ee?k[S]:S;M+=l(c[I][re],S)}I<c.length-1&&(!N||0<q&&!B)&&(M+=y)}}return M}function l(k,c){var N,M;return k==null?"":k.constructor===Date?JSON.stringify(k).slice(1,25):(M=!1,w&&typeof k=="string"&&w.test(k)&&(k="'"+k,M=!0),N=k.toString().replace(f,O),(M=M||r===!0||typeof r=="function"&&r(k,c)||Array.isArray(r)&&r[c]||((J,ee)=>{for(var C=0;C<ee.length;C++)if(-1<J.indexOf(ee[C]))return!0;return!1})(N,n.BAD_DELIMITERS)||-1<N.indexOf(i)||N.charAt(0)===" "||N.charAt(N.length-1)===" ")?z+N+z:N)}},n.RECORD_SEP="",n.UNIT_SEP="",n.BYTE_ORDER_MARK="\uFEFF",n.BAD_DELIMITERS=["\r",`
`,'"',n.BYTE_ORDER_MARK],n.WORKERS_SUPPORTED=!_&&!!a.Worker,n.NODE_STREAM_INPUT=1,n.LocalChunkSize=10485760,n.RemoteChunkSize=5242880,n.DefaultDelimiter=",",n.Parser=K,n.ParserHandle=G,n.NetworkStreamer=L,n.FileStreamer=v,n.StringStreamer=F,n.ReadableStreamStreamer=te,a.jQuery&&((u=a.jQuery).fn.parse=function(e){var t=e.config||{},r=[];return this.each(function(y){if(!(u(this).prop("tagName").toUpperCase()==="INPUT"&&u(this).attr("type").toLowerCase()==="file"&&a.FileReader)||!this.files||this.files.length===0)return!0;for(var z=0;z<this.files.length;z++)r.push({file:this.files[z],inputElem:this,instanceConfig:u.extend({},t)})}),o(),this;function o(){if(r.length===0)E(e.complete)&&e.complete();else{var y,z,O,T,d=r[0];if(E(e.before)){var w=e.before(d.file,d.inputElem);if(typeof w=="object"){if(w.action==="abort")return y="AbortError",z=d.file,O=d.inputElem,T=w.reason,void(E(e.error)&&e.error({name:y},z,O,T));if(w.action==="skip")return void i();typeof w.config=="object"&&(d.instanceConfig=u.extend(d.instanceConfig,w.config))}else if(w==="skip")return void i()}var f=d.instanceConfig.complete;d.instanceConfig.complete=function(H){E(f)&&f(H,d.file,d.inputElem),i()},n.parse(d.file,d.instanceConfig)}}function i(){r.splice(0,1),o()}}),h&&(a.onmessage=function(e){e=e.data,n.WORKER_ID===void 0&&e&&(n.WORKER_ID=e.workerId),typeof e.input=="string"?a.postMessage({workerId:n.WORKER_ID,results:n.parse(e.input,e.config),finished:!0}):(a.File&&e.input instanceof File||e.input instanceof Object)&&(e=n.parse(e.input,e.config))&&a.postMessage({workerId:n.WORKER_ID,results:e,finished:!0})}),(L.prototype=Object.create(j.prototype)).constructor=L,(v.prototype=Object.create(j.prototype)).constructor=v,(F.prototype=Object.create(F.prototype)).constructor=F,(te.prototype=Object.create(j.prototype)).constructor=te,n})})(ve)),ve.exports}var Ge=Ye();const Le=Ie(Ge);function Ae(p){const g=(p||"").trim().toLowerCase();if(!g)return[];const b=g.replace(/[^a-z0-9]/g,""),a=g.replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");return Array.from(new Set([g,b,a].filter(Boolean)))}function Ze(p={}){const g={};for(const[b,a]of Object.entries(p)){const u=(a||"").toString().trim(),_=Ae(b);for(const h of _)g[h]===void 0&&(g[h]=u)}return g}function _e(p=""){const g=p.trim();return g?g.charAt(0).toUpperCase()+g.slice(1).toLowerCase():""}function et(p={}){const g=(p.full_name||p.fullname||"").trim();if(g){const[A="",...R]=g.split(/\s+/),n=R.join(" "),j=_e(A),L=_e(n);return{first:j,last:L,name:[j,L].filter(Boolean).join(" ").trim()}}const b=p.first_name||p.firstname||"",a=p.last_name||p.lastname||"",u=_e(b),_=_e(a),h=_e(p.name||p.contact||"");return{first:u,last:_,name:[u,_].filter(Boolean).join(" ").trim()||h}}function tt(p){return new Promise((g,b)=>{Le.parse(p,{header:!0,skipEmptyLines:!0,transformHeader:a=>a.trim(),complete:a=>{var L;if(a.errors.length>0){const v=a.errors.find(F=>F.type==="Delimiter"||F.type==="Quotes");if(v)return b(new Error(`CSV parse error: ${v.message}`))}const u=a.data,_=((L=a.meta)==null?void 0:L.fields)||Object.keys(u[0]||{}),h=_.find(v=>Ae(v).includes("lastcontacted")),A=_.find(v=>{const F=(v||"").trim().toLowerCase();return/^(e-?mail(address)?|mail)$/.test(F)});if(!A)return b(new Error('No "email" column found in CSV. Please include a column named "email" (or "mail", "emailaddress").'));let R=0,n=0;const j=u.map((v,F)=>{if(h?(v[h]||"").toString().trim():"")return n+=1,null;const G=(v[A]||"").trim();if(!G||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(G))return R+=1,null;const X=Ze(v),K=et(X),Z=K.name,Q={...Object.fromEntries(Object.entries(v).map(([ce,de])=>[ce,(de||"").toString().trim()])),...X};return Q.email=G,K.first&&(Q.first_name=K.first,Q.firstname=K.first),K.last&&(Q.last_name=K.last,Q.lastname=K.last),Z&&(Q.name=Z),Z&&(Q.full_name=Z,Q.fullname=Z),{email:G,name:Z,__rowIndex:F,...Q}}).filter(Boolean);g({recipients:j,totalRows:u.length,skipped:u.length-j.length,skippedInvalidEmail:R,skippedPreviouslyContacted:n,headers:_,rows:u,lastContactedKey:h})},error:a=>b(new Error(a.message))})})}function rt(p=[],g=[]){return Le.unparse({fields:p,data:g.map(b=>p.map(a=>(b==null?void 0:b[a])??""))})}async function nt(p,g,b){try{return(await p.acquireTokenSilent({...b,account:g})).accessToken}catch{return(await p.acquireTokenPopup(b)).accessToken}}async function st(p,g,b,a,u,_){var R;const h={subject:a,importance:"normal",body:{contentType:"HTML",content:u},toRecipients:[{emailAddress:{address:g,name:b||g}}],..._},A=await fetch("https://graph.microsoft.com/v1.0/me/sendMail",{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({message:h,saveToSentItems:!0})});if(!A.ok){const n=await A.json().catch(()=>({})),j=((R=n==null?void 0:n.error)==null?void 0:R.message)||`HTTP ${A.status}`;throw new Error(j)}return!0}const it="_header_1spdz_1",at="_logo_1spdz_10",ot="_userArea_1spdz_16",lt="_username_1spdz_22",ct="_signOutBtn_1spdz_27",ye={header:it,logo:at,userArea:ot,username:lt,signOutBtn:ct};function ut({account:p,isAuthenticated:g,instance:b}){const a=()=>{b.logoutPopup({postLogoutRedirectUri:window.location.origin})};return s.jsxs("header",{className:ye.header,children:[s.jsx("div",{className:ye.logo,children:"ShakeDefi Marketing"}),g&&p&&s.jsxs("div",{className:ye.userArea,children:[s.jsx("span",{className:ye.username,children:p.username}),s.jsx("button",{className:ye.signOutBtn,onClick:a,children:"Sign Out"})]})]})}function dt(){var i,y,z;const{instance:p,accounts:g}=De(),b=Pe(),a=g[0],[u,_]=ne.useState(null),[h,A]=ne.useState(null),[R,n]=ne.useState(""),[j,L]=ne.useState(""),[v,F]=ne.useState(0),[te,G]=ne.useState(!1),[X,K]=ne.useState([]),[Z,Q]=ne.useState(""),ce=((a==null?void 0:a.username)||"").toLowerCase().endsWith("@shakedefi.com"),de=async O=>{var d;const T=(d=O.target.files)==null?void 0:d[0];if(T){L("");try{const w=await Ve(T);_(w),n(w.subject||"")}catch(w){L(`DOCX parse error: ${w.message}`)}}},se=async O=>{var d;const T=(d=O.target.files)==null?void 0:d[0];if(T){L("");try{const w=await tt(T);A(w),F(0)}catch(w){L(`CSV parse error: ${w.message}`)}}},E=(i=h==null?void 0:h.recipients)==null?void 0:i[v],e=ne.useMemo(()=>u!=null&&u.html?be(u.html,E||{}):"",[u,E]),t=ne.useMemo(()=>R?be(R,E||{}):"",[R,E]),r=async()=>{var O;if(a){if(!ce){L("Please sign in with your @shakedefi.com Microsoft account.");return}if(!u||!((O=h==null?void 0:h.recipients)!=null&&O.length)){L("Upload both a .docx and a valid .csv file first.");return}if(!R.trim()){L("Email subject is required.");return}G(!0),L(""),K([]),Q("");try{const T=await nt(p,a,Oe),d=(h.rows||[]).map(l=>({...l})),w=[...h.headers||[]],f=h.lastContactedKey||"Last Contacted";w.includes(f)||w.push(f);for(const l of h.recipients){const k=be(u.html,l),c=be(R,l);try{await st(T,l.email,l.name||l.company||l.email,c,k);const N=l.__rowIndex;N!==void 0&&d[N]&&(d[N][f]=new Date().toISOString()),K(M=>[...M,{email:l.email,status:"sent"}])}catch(N){K(M=>[...M,{email:l.email,status:"failed",error:N.message}])}await new Promise(N=>setTimeout(N,350))}const H=rt(w,d);Q(H),A(l=>l&&{...l,rows:d,headers:w,lastContactedKey:f})}catch(T){L(`Unable to send emails: ${T.message}`)}finally{G(!1)}}},o=()=>{if(!Z)return;const O=new Blob([Z],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(O),d=document.createElement("a");d.href=T,d.download=`recipients-updated-${new Date().toISOString().replace(/[:.]/g,"-")}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(T)};return s.jsxs(s.Fragment,{children:[s.jsx(ut,{account:a,isAuthenticated:b,instance:p}),s.jsx("main",{className:"mailer-shell",children:s.jsx("section",{className:"mailer-panel",children:b?s.jsxs("div",{className:"workflow",children:[!ce&&s.jsx("p",{className:"error-text",children:"Please use a @shakedefi.com account to send campaigns."}),s.jsxs("div",{className:"help-box",children:[s.jsx("h2",{children:"Preparing your files"}),s.jsxs("ul",{children:[s.jsxs("li",{children:["DOCX: first line can be ",s.jsx("code",{children:"Subject: Your email subject"})]}),s.jsx("li",{children:"DOCX: or first H1 heading becomes the subject"}),s.jsxs("li",{children:["Body supports variables like ",s.jsx("code",{children:"{{name}}"}),", ",s.jsx("code",{children:"{{company}}"}),", ",s.jsx("code",{children:"{{customfield}}"})]}),s.jsxs("li",{children:["CSV requires ",s.jsx("code",{children:"email"})," (or ",s.jsx("code",{children:"mail"})," / ",s.jsx("code",{children:"emailaddress"}),")"]}),s.jsxs("li",{children:["Optional columns: ",s.jsx("code",{children:"name"}),", ",s.jsx("code",{children:"company"}),", and any template variables"]})]})]}),s.jsxs("div",{className:"upload-grid",children:[s.jsxs("label",{className:"upload-card",children:[s.jsx("span",{children:"Upload .docx email body"}),s.jsx("input",{type:"file",accept:".docx",onChange:de})]}),s.jsxs("label",{className:"upload-card",children:[s.jsx("span",{children:"Upload .csv recipients"}),s.jsx("input",{type:"file",accept:".csv",onChange:se})]})]}),(u||h)&&s.jsxs("div",{className:"status-row",children:[s.jsx("span",{children:u?"✅ DOCX loaded":"⬜ DOCX not loaded"}),s.jsx("span",{children:h?`✅ ${h.recipients.length} valid recipients${h.skipped?` (${h.skipped} skipped)`:""}`:"⬜ CSV not loaded"})]}),s.jsxs("label",{className:"subject-field",children:["Subject",s.jsx("input",{value:R,onChange:O=>n(O.target.value),placeholder:"Your email subject"})]}),((y=h==null?void 0:h.recipients)==null?void 0:y.length)>0&&s.jsxs("div",{className:"preview-wrap",children:[s.jsxs("div",{className:"recipient-list",children:[s.jsx("h3",{children:"Recipients"}),h.recipients.map((O,T)=>s.jsx("button",{className:T===v?"recipient-btn active":"recipient-btn",onClick:()=>F(T),children:O.email},`${O.email}-${T}`))]}),s.jsxs("div",{className:"preview-panel",children:[s.jsx("h3",{children:"Personalized Preview"}),s.jsxs("p",{children:[s.jsx("strong",{children:"To:"})," ",(E==null?void 0:E.email)||"—"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Subject:"})," ",t||"—"]}),s.jsx("div",{className:"email-html",dangerouslySetInnerHTML:{__html:e}})]})]}),s.jsx("button",{className:"send-btn",disabled:te||!ce||!u||!((z=h==null?void 0:h.recipients)!=null&&z.length)||!R.trim(),onClick:r,children:te?"Sending…":"Send All Emails"}),j&&s.jsx("p",{className:"error-text",children:j}),X.length>0&&s.jsxs("div",{className:"results",children:[s.jsx("h3",{children:"Send Results"}),s.jsx("ul",{children:X.map((O,T)=>s.jsxs("li",{children:[O.status==="sent"?"✅":"❌"," ",O.email,O.error?` — ${O.error}`:""]},`${O.email}-${T}`))}),Z&&s.jsx("button",{className:"send-btn",onClick:o,children:"Download Updated CSV"})]})]}):s.jsxs("div",{children:[s.jsx("p",{className:"signed-in-text",children:"Sign in with your @shakedefi.com Microsoft account to begin."}),s.jsx("button",{className:"signin-btn",onClick:()=>p.loginPopup(Oe),children:"Microsoft Exchange Sign In"})]})})})]})}const ht=new Me(We);He.createRoot(document.getElementById("root")).render(s.jsx(ne.StrictMode,{children:s.jsx(Fe,{instance:ht,children:s.jsx(dt,{})})}));
